<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>sign in</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
    <script src="amazon-cognito-identity.min.js"></script>
    <script src="jwt-decode.js"></script>
</head>
<body>
<!--
    As there is no back-end we don't post this form,  instead we attach a function to the onclick action of a button.
-->

<div id="signin_div">
    <form method="POST" action="/sign_in">
        <div class="container text-center">
        <div class="row">
            <div class="col-4">Username</div>
            <div class="col-4"><input id="username" required type="text" maxlength="40"></div>
        </div>
        <div class="row">
            <div class="col-4">Password</div>
            <div class="col-4"><input id="password" required type="password" maxlength="25"></div>
        </div>
        <div class="row">
            <div class="col-4">    
            <button id="signupSubmit" type="button" onclick="signIn()" class="btn btn-primary">
            Login</button>
            </div>
        </div>
        </div>
    </form>
</div>

<script>
    AWS_COGNITO_USER_POOL_ID = 'eu-west-2_7EYlL3eMQ';
    AWS_COGNITO_USER_POOL_CLIENT_ID = 'ffjmv51r3e7s0ht3b4eo7s93c';
    REDIRECT_TO = 'index.html';

    signIn = function(){
        const password = document.getElementById('password').value;
        const username = document.getElementById('username').value;
    
    var authenticationData = {
        Username : username,
        Password : password
    }    
    var authenticationDetails = new AmazonCognitoIdentity.AuthenticationDetails(authenticationData);
    var poolData = {
        UserPoolId : AWS_COGNITO_USER_POOL_ID,
        ClientId : AWS_COGNITO_USER_POOL_CLIENT_ID
    };
    var userPool = new AmazonCognitoIdentity.CognitoUserPool(poolData);
    var userData = {
        Username : username,
        Pool : userPool
    };
    var cognitoUser = new AmazonCognitoIdentity.CognitoUser(userData);
    
    cognitoUser.authenticateUser(authenticationDetails, {
        onSuccess: function (result) {
            let jwtToken = result.getIdToken().getJwtToken();
            var decoded = jwt_decode(jwtToken);
            console.log(decoded);
            location.href = REDIRECT_TO;
        },
        onFailure: function(err) {
            console.log(err);
        },
        newPasswordRequired: function(userAttributes, requiredAttributes) { 
            console.log('new password required');
            console.log(userAttributes);
            console.log(requiredAttributes);
        }
    });
    } 
    </script>
</body>

